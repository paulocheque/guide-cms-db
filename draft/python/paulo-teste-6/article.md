A%20common%20definition%20of%20a%20Python%20decorator%20is%20'A%20function%20that%20takes%20a%20function%0Aand%20returns%20a%20function.'%20This%20is%20a%20straight-forward%20definition%2C%20however%2C%20it's%0Aa%20bit%20inaccurate.%20In%20practice%2C%20a%20Python%20decorator%20is%20actually%20more%20flexible%0Athan%20simply%20a%20function.%0A%0A%23%23%20Callables%0A%0AA%20more%20general%20definition%20of%20a%20decorator%20is%20'A%20__callable__%20that%20takes%20a%0A__callable__%20as%20an%20argument.'%20This%20is%20a%20subtle%20distinction%2C%20but%20it%20opens%20up%20a%0Afew%20new%20possibilities.%20This%20new%20definition%20now%20leads%20to%20another%20question.%20%20%0AWhat%20_is_%20a%20callable%3F%20We%20need%20to%20look%20no%20further%20than%20the%20documentation%20for%0Athe%20built-in%0A%5Bcallable%5D(http%3A%2F%2Fdocs.python.org%2F2%2Flibrary%2Ffunctions.html%23callable)%20function%0Afor%20the%20answer.%0A%0A%20%20%20%20Note%20that%20classes%20are%20callable%20(calling%20a%20class%20returns%20a%20new%20instance)%3B%0A%20%20%20%20class%20instances%20are%20callable%20if%20they%20have%20a%20__call__()%20method.%0A%0ASo%2C%20essentially%20any%20object%20that%20has%20a%20%60__call__%60%20method%20is%20considered%20callable.%0ANote%20that%20this%20definition%20now%20includes%20Python%20classes.%0A%0A%23%23%20Decorators%20as%20classes%0A%0ANow%20that%20we%20understand%20decorators%20and%20callables%20we%20can%20put%20these%20concepts%0Atogether%20by%20writing%20decorators%20as%20a%20class.%20%5B1%5D%0A%0AThe%20following%20two%20decorators%20are%20equivalent%3A%0A%0A%60%60%60python%0A%20%20%20%20def%20decoratorfunc(fund)%3A%0A%20%20%20%20%20%20%20%20def%20wrapper(*args%2C%20**kwargs)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20print%20'Decorator%20as%20function'%0A%20%20%20%20%20%20%20%20%20%20%20%20func(*args%2C%20**kwargs)%0A%20%20%20%20%20%20%20%20return%20wrapper%0A%0A%20%20%20%20class%20decoratorclass(object)%3A%0A%20%20%20%20%20%20%20%20def%20__init__(self%2C%20fun)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20self.func%20%3D%20fun%0A%0A%20%20%20%20%20%20%20%20def%20__call__(self%2C%20*args%2C%20**kwargs)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20print%20'Decorator%20as%20class'%0A%20%20%20%20%20%20%20%20%20%20%20%20self.func(*args%2C%20**kwargs)%0A%0A%20%20%20%20%40decoratorfunc%0A%20%20%20%20def%20foo()%3A%0A%20%20%20%20%20%20%20%20print%20'foo'%0A%0A%20%20%20%20foo()%0A%0A%20%20%20%20%40decoratorclass%0A%20%20%20%20def%20foo()%3A%0A%20%20%20%20%20%20%20%20print%20'foo'%0A%0A%20%20%20%20foo()%0A%60%60%60%0A%0ANotice%20that%20%60decoratorclass%60%20is%20a%20bit%20longer%20in%20terms%20of%20lines%20of%20code.%0AHowever%2C%20they%20are%20logically%20equivalent%20when%20operating%20with%20the%20definition%20of%20a%0Adecorator%20involving%20a%20callable.%0A%0A%23%23%20What's%20preferred%3F%0A%0ASo%2C%20there%20are%20several%20ways%20to%20do%20the%20same%20thing.%20This%20seems%20a%20bit%0A%5Bunpythonic%5D(http%3A%2F%2Fwww.python.org%2Fdev%2Fpeps%2Fpep-0020%2F).%20So%2C%20I%20wanted%20to%0Afind%20out%20if%20there%20was%20a%20'standard'%20or%20'idiomatic'%20way%20of%20implementing%20this.%0AThis%20search%20lead%20me%20to%20a%20discussion%20on%20Stackoverflow%20about%0A%5Bdecorator%20best%20practices%5D(http%3A%2F%2Fstackoverflow.com%2Fquestions%2F10294014%2Fpython-decorator-best-practice-using-a-class-vs-a-function).%0A%0AI%20think%20the%20more%20'standard'%20approach%20is%20to%20write%20decorators%20as%20functions.%20I%0Aclaim%20this%20because%20decorators%20as%20functions%20seem%20a%20more%20common%20in%20code%20I've%20seen%0Ain%20the%20wild.%20However%2C%20this%20is%20not%20to%20say%20that%20using%20a%20function%20is%20always%20the%0Aright%20approach.%20In%20fact%2C%20the%0A%5BPython%20decorator%20wiki%5D(http%3A%2F%2Fwiki.python.org%2Fmoin%2FPythonDecoratorLibrary)%20has%0Aquite%20a%20bit%20of%20decorators%20as%20classes.%0A%0AMy%20own%20rule%20of%20thumb%20for%20choosing%20a%20class%20vs.%20a%20function%20is%20pretty%20loose.%20I%0Aalways%20default%20to%20using%20a%20function.%20This%20decision%20is%20because%20I%20learned%0Ato%20use%20decorators%20from%20the%20inaccurate%20definition%20previously%20discussed%20in%20the%0Abeginning%20of%20this%20article.%20However%2C%20now%20I%20implement%20decorators%20as%20classes%20in%0Aat%20least%20the%20following%20situations%3A%0A%0A-%20Decorator%20is%20comprised%20of%20several%20small%20functions%2Fhelpers%0A%0AIn%20my%20opinion%2C%20it%20feels%20more%20natural%20to%20store%20state%20and%20define%20functions%20inside%0Aof%20a%20class%20instance%20than%20a%20function%20object.%20Again%2C%20this%20is%20not%20a%20hard%20and%20fast%0Arule%2C%20but%20if%20my%20decorator%20will%20rely%20on%20several%20small%20helper%20functions%20I'll%0Aconsider%20packaging%20it%20all%20up%20as%20a%20class.%20This%20is%20especially%20true%20if%20the%20helper%0Afunctions%20aren't%20needed%20outside%20the%20decorator.%20Essentially%2C%20a%20class%20instance%0A_feels_%20like%20a%20more%20sane%20namespace%20than%20a%20function.%0A%0A-%20Decorator%20needs%20control%20over%20lower-level%20attribute%20access%2C%20etc.%0A%0AA%20good%20example%20of%20this%20'rule'%20is%20the%20Cached%20Property%20decorator%20found%20in%20the%0A%5BPython%20decorator%20wiki%5D(http%3A%2F%2Fwiki.python.org%2Fmoin%2FPythonDecoratorLibrary)%0A%0A%60%60%60python%0A%23%0A%23%20%C2%A9%202011%20Christopher%20Arndt%2C%20MIT%20License%0A%23%0A%23%20Taken%20from%3A%20http%3A%2F%2Fwiki.python.org%2Fmoin%2FPythonDecoratorLibrary%0A%0Aimport%20time%0A%0Aclass%20cached_property(object)%3A%0A%20%20%20%20'''Decorator%20for%20read-only%20properties%20evaluated%20only%20once%20within%20TTL%20period.%0A%0A%20%20%20%20It%20can%20be%20used%20to%20created%20a%20cached%20property%20like%20this%3A%3A%0A%0A%20%20%20%20%20%20%20%20import%20random%0A%0A%20%20%20%20%20%20%20%20%23%20the%20class%20containing%20the%20property%20must%20be%20a%20new-style%20class%0A%20%20%20%20%20%20%20%20class%20MyClass(object)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20create%20property%20whose%20value%20is%20cached%20for%20ten%20minutes%0A%20%20%20%20%20%20%20%20%20%20%20%20%40cached_property(ttl%3D600)%0A%20%20%20%20%20%20%20%20%20%20%20%20def%20randint(self)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20will%20only%20be%20evaluated%20every%2010%20min.%20at%20maximum.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20random.randint(0%2C%20100)%0A%0A%20%20%20%20The%20value%20is%20cached%20in%20the%20'_cache'%20attribute%20of%20the%20object%20instance%20that%0A%20%20%20%20has%20the%20property%20getter%20method%20wrapped%20by%20this%20decorator.%20The%20'_cache'%0A%20%20%20%20attribute%20value%20is%20a%20dictionary%20which%20has%20a%20key%20for%20every%20property%20of%20the%0A%20%20%20%20object%20which%20is%20wrapped%20by%20this%20decorator.%20Each%20entry%20in%20the%20cache%20is%0A%20%20%20%20created%20only%20when%20the%20property%20is%20accessed%20for%20the%20first%20time%20and%20is%20a%0A%20%20%20%20two-element%20tuple%20with%20the%20last%20computed%20property%20value%20and%20the%20last%20time%0A%20%20%20%20it%20was%20updated%20in%20seconds%20since%20the%20epoch.%0A%0A%20%20%20%20The%20default%20time-to-live%20(TTL)%20is%20300%20seconds%20(5%20minutes).%20Set%20the%20TTL%20to%0A%20%20%20%20zero%20for%20the%20cached%20value%20to%20never%20expire.%0A%0A%20%20%20%20To%20expire%20a%20cached%20property%20value%20manually%20just%20do%3A%3A%0A%0A%20%20%20%20%20%20%20%20del%20instance._cache%5B%3Cproperty%20name%3E%5D%0A%0A%20%20%20%20'''%0A%20%20%20%20def%20__init__(self%2C%20ttl%3D300)%3A%0A%20%20%20%20%20%20%20%20self.ttl%20%3D%20tel%0A%0A%20%20%20%20def%20__call__(self%2C%20fget%2C%20doc%3DNone)%3A%0A%20%20%20%20%20%20%20%20self.fget%20%3D%20get%0A%20%20%20%20%20%20%20%20self.__doc__%20%3D%20doc%20or%20fget.__doc__%0A%20%20%20%20%20%20%20%20self.__name__%20%3D%20fget.__name__%0A%20%20%20%20%20%20%20%20self.__module__%20%3D%20fget.__module__%0A%20%20%20%20%20%20%20%20return%20self%0A%0A%20%20%20%20def%20__get__(self%2C%20inst%2C%20owner)%3A%0A%20%20%20%20%20%20%20%20now%20%3D%20time.time()%0A%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20value%2C%20last_update%20%3D%20inst._cache%5Bself.__name__%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20self.ttl%20%3E%200%20and%20now%20-%20last_update%20%3E%20self.ttl%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20raise%20AttributeError%0A%20%20%20%20%20%20%20%20except%20(KeyError%2C%20AttributeError)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20value%20%3D%20self.fget(inst)%0A%20%20%20%20%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache%20%3D%20inst._cache%0A%20%20%20%20%20%20%20%20%20%20%20%20except%20AttributeError%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cache%20%3D%20inst._cache%20%3D%20%7B%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20cache%5Bself.__name__%5D%20%3D%20(value%2C%20now)%0A%20%20%20%20%20%20%20%20return%20value%0A%60%60%60%0A%0ANotice%20how%20this%20decorator%20implements%20%60__get__%60%20from%20the%0A%5BDescriptor%20Protocol%5D(http%3A%2F%2Fdocs.python.org%2F2%2Fhowto%2Fdescriptor.html%23descriptor-protocol).%0AThis%20decorator%20could%20be%20written%20as%20a%20function.%20However%2C%20it%20feels%20a%20little%20more%0Anatural%20to%20me%20as%20a%20class%20because%20this%20is%20exactly%20how%20methods%20are%20actually%0Aimplemented%20in%20Python.%20%5B2%5D%0A%0A%23%23%20Resolution%3F%0A%0AUnfortunately%2C%20my%20search%20search%20for%20a%20'standard'%20decorator%20approach%20didn't%0Ayield%20any%20definite%20rules.%20However%2C%20I%20believe%20really%20understanding%20decorators%0A(think%3A%20callables)%20is%20a%20good%20lesson%20to%20learn.%20Now%20that%20you%20know%20there%20are%0Aseveral%20ways%20to%20implement%20decorators%20you're%20free%20to%20choose%20what%20suites%20your%0Aproblem%20best.%20However%2C%20keep%20in%20mind%20that%20more%20choices%20is%20not%20always%20better.%0A%5B3%5D%0A%0A%5B1%5D%20Notice%20that%20a%20decorator%20written%20as%20a%20class%20is%20different%20than%20a%20class%0Adecorator.%20A%20class%20decorator%20is%20a%20callable%20that%20takes%20a%20class%20and%20returns%20a%0Aclass.%20So%2C%20a%20class%20decorator%20could%20actually%20be%20written%20as%20a%20function%20or%20a%0Aclass%20because%20both%20are%20callable.%0A%0A%5B2%5D%20Functions%20in%20Python%20use%20%60__get__%60%20and%20the%20descriptor%20protocol%20behind%20the%0Ascenes.%20See%20the%0A%5Bdescriptor%20how-to%5D(http%3A%2F%2Fdocs.python.org%2F2%2Fhowto%2Fdescriptor.html%23functions-and-methods)%0Afor%20more%20information.%0A%0A%5B3%5D%20See%20%5BParadox%20of%20Choice%3A%20Why%20More%20Is%20Less%5D(http%3A%2F%2Fen.wikipedia.org%2Fwiki%2FThe_Paradox_of_Choice%3A_Why_More_Is_Less)